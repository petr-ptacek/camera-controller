<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport"
	      content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>CameraController - Test</title>
</head>
<body>
	<div id="app">
		<div class="buttons-wrapper">
			<button class="btn" id="btn-camera-on">Camera On</button>
			<button class="btn" id="btn-camera-off">Camera Off</button>
			<button class="btn" id="btn-make-screenshot-base64">Screenshot As Base64</button>
			<button class="btn" id="btn-make-screenshot-img">Screenshot As Img</button>
			<button class="btn" id="btn-make-screenshot-file">Screenshot As File</button>
		</div>

		<div class="content">
			<div id="video-wrapper"></div>
			<div id="screenshot-chunk"></div>
		</div>
	</div>
	<script src="CameraController.umd.js"></script>
	<script>
		const btnCameraOn = document.getElementById('btn-camera-on');
		const btnCameraOff = document.getElementById('btn-camera-off');
		const btnScreenshotAsBase64 = document.getElementById('btn-make-screenshot-base64');
		const btnScreenshotAsImg = document.getElementById('btn-make-screenshot-img');
		const btnScreenshotAsFile = document.getElementById('btn-make-screenshot-file');

		const cameraController = new window.CameraController({
			videoOptions: {
				width: 200,
				height: 200,
				elementOrSelector: '#video-wrapper'
			},
			screenshotOptions: {
				width: 300,
				height: 300,
				useAspectRatio: true
			},
			onRecordingStart() {
				console.log('Recording start!');
			},
			onRecordingEnd() {
				console.log('Recording end!');
			},
			onRecordingInterrupted() {
				console.log('Recording Interrupted!');
			},
			onDeviceNotAvailable() {
				console.log('Device not available!');
			},
			onDevicePermissionDenied() {
				console.log('Device permission denied!');
			}
		});

		function startCamera() {
			cameraController.startRecording();
		}

		function stopCamera() {
			cameraController.stopRecording();
		}

		async function makeScreenshotImg() {
			const screenshotImg = await cameraController.getScreenshotAsImg();

			if ( screenshotImg ) {
				document.getElementById('screenshot-chunk').innerHTML = '';
				document.getElementById('screenshot-chunk').append(screenshotImg);
			}
		}

		async function makeScreenshotFile() {
			const file = await cameraController.getScreenshotAsFile();
			console.dir(file);
		}

		async function makeScreenshotBase64() {
			const screenshotBase64 = await cameraController.getScreenshotAsBase64();

			if ( screenshotBase64 ) {
				const img = new Image();
				img.src = screenshotBase64;

				document.getElementById('screenshot-chunk').innerHTML = '';
				document.getElementById('screenshot-chunk').append(img);
			}
		}

		btnCameraOn.addEventListener('click', startCamera);
		btnCameraOff.addEventListener('click', stopCamera);
		btnScreenshotAsBase64.addEventListener('click', makeScreenshotBase64);
		btnScreenshotAsImg.addEventListener('click', makeScreenshotImg);
		btnScreenshotAsFile.addEventListener('click', makeScreenshotFile);
	</script>
</body>
</html>